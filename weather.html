<!DOCTYPE html>
<html lang="en">
<!-- ... head and style sections remain the same ... -->

<body>
    <h1>Weather and Air Quality Data</h1>
    <div class="timestamp" id="timestamp"></div>
    <button onclick="fetchData()">Refresh Data</button>
    <div class="card" id="results">
        <div class="data-grid">
            <!-- Data will be inserted here -->
        </div>
    </div>

    <script>
        async function fetchData() {
            try {
                const response = await fetch('https://roddsrod.github.io/weather/weather.xml', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/xml',
                        'Content-Type': 'application/xml',
                    },
                    cache: 'no-cache'
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const xmlText = await response.text();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, 'text/xml');

                const current = xmlDoc.querySelector('current');
                if (!current) {
                    throw new Error('No current data found in XML');
                }

                const dataGrid = document.querySelector('.data-grid');
                dataGrid.innerHTML = '';

                const dataItems = [
                    { key: 'city', label: 'City', unit: '' },
                    { key: 'temperature', label: 'Temperature', unit: '°C' },
                    { key: 'feelslike', label: 'Feels Like', unit: '°C' },
                    { key: 'wind', label: 'Wind Speed', unit: 'km/h' },
                    { key: 'humidity', label: 'Humidity', unit: '%' },
                    { key: 'visibility', label: 'Visibility', unit: '' },
                    { key: 'UV', label: 'UV Index', unit: '' },
                    { key: 'CO', label: 'CO', unit: 'µg/m³' },
                    { key: 'NO2', label: 'NO2', unit: 'µg/m³' },
                    { key: 'PM2\\.5', label: 'PM2.5', unit: 'µg/m³' }, // Changed selector
                    { key: 'PM10', label: 'PM10', unit: 'µg/m³' }
                ];

                dataItems.forEach(item => {
                    // Use getElementsByTagName instead of querySelector for more reliable selection
                    const elements = current.getElementsByTagName(item.key.replace('\\', ''));
                    if (elements.length > 0 && elements[0].textContent) {
                        const div = document.createElement('div');
                        div.className = 'data-item';
                        div.innerHTML = `
                            <div class="label">${item.label}</div>
                            <div class="value">${elements[0].textContent}${item.unit}</div>
                        `;
                        dataGrid.appendChild(div);
                    }
                });

                // Update timestamp
                const now = new Date();
                document.getElementById('timestamp').textContent = 
                    `Last updated: ${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;

            } catch (error) {
                console.error('Detailed error:', error);
                document.querySelector('.data-grid').innerHTML = `
                    <div class="data-item" style="grid-column: 1 / -1; color: red;">
                        Error loading data. Please try again later.<br>
                        Error details: ${error.message}<br>
                        <small>Check browser console for more information.</small>
                    </div>`;
            }
        }

        // Fetch data when page loads
        document.addEventListener('DOMContentLoaded', fetchData);
    </script>
</body>
</html>
